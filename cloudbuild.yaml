steps:

  - name: 'gcr.io/cloud-builders/docker'
    args: ['pull','gcr.io/$PROJECT_ID/minerva-testing:latest']

  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'build',
      '-t', 'gcr.io/$PROJECT_ID/minerva-testing:latest',
      '--cache-from', 'gcr.io/$PROJECT_ID/minerva-testing:latest',
      '.'
      ]

  - name: 'gcr.io/cloud-builders/npm'
    args: ['install']

  - name: 'gcr.io/$PROJECT_ID/minerva-testing:latest'
    entrypoint: '/bin/sh'
    args:
      - '-c'
      - |
        npm run e2e

  - name: 'gcr.io/$PROJECT_ID/minerva-testing:latest'
    entrypoint: '/bin/sh'
    args:
      - '-c'
      - |
        npm run test-headless

timeout: 3600s
images: ['gcr.io/$PROJECT_ID/minerva-testing:latest']
